<div class="p-4">
  <div
    *ngIf="dataSource.data.length === 0"
    class="text-center text-slate-500 p-12 border rounded-xl"
  >
    No hay tareas aún.
  </div>

  <div
    *ngIf="dataSource.data.length > 0"
    class="overflow-x-auto rounded-xl border border-slate-200 shadow-sm"
  >
    <table
      mat-table
      [dataSource]="dataSource"
      [trackBy]="trackRow"
      class="w-full min-w-[840px]"
    >
      <!-- Nombre -->
      <ng-container matColumnDef="nombre">
        <th mat-header-cell *matHeaderCellDef>Nombre</th>
        <td mat-cell *matCellDef="let row">
          <div class="font-medium">{{ row.nombre }}</div>
        </td>
      </ng-container>

      <!-- Descripción -->
      <ng-container matColumnDef="descripcion">
        <th mat-header-cell *matHeaderCellDef>Descripción</th>
        <td mat-cell *matCellDef="let row">
          <div class="whitespace-pre-wrap break-words max-w-[420px]">
            {{ row.descripcion }}
          </div>
        </td>
      </ng-container>

      <!-- Prioridad -->
      <ng-container matColumnDef="prioridad">
        <th mat-header-cell *matHeaderCellDef>Prioridad</th>
        <td mat-cell *matCellDef="let row">
          <span
            class="px-2 py-0.5 rounded-full text-xs"
            [ngClass]="{
              'bg-red-100 text-red-700': row.prioridad === 'alta',
              'bg-amber-100 text-amber-700': row.prioridad === 'mediana',
              'bg-emerald-100 text-emerald-700': row.prioridad === 'baja'
            }"
          >
            {{ row.prioridad | titlecase }}
          </span>
        </td>
      </ng-container>

      <!-- Fecha límite -->
      <ng-container matColumnDef="fechaLimite">
        <th mat-header-cell *matHeaderCellDef>Fecha límite</th>
        <td mat-cell *matCellDef="let row">
          {{ row.fechaLimite ? (row.fechaLimite | date : "mediumDate") : "—" }}
        </td>
      </ng-container>

      <!-- Fecha creación -->
      <ng-container matColumnDef="fechaCreacion">
        <th mat-header-cell *matHeaderCellDef>Creación</th>
        <td mat-cell *matCellDef="let row">
          {{ row.fechaCreacion | date : "medium" }}
        </td>
      </ng-container>

      <!-- Status -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Estado</th>
        <td mat-cell *matCellDef="let row">
          <mat-select
            [value]="row.status"
            (selectionChange)="changeStatus(row, $event.value)"
            class="min-w-[150px]"
          >
            <mat-option value="creada">Creada</mat-option>
            <mat-option value="en progreso">En progreso</mat-option>
            <mat-option value="completada">Completada</mat-option>
          </mat-select>
        </td>
      </ng-container>

      <!-- Acciones -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="text-right pr-4">
          acciones
        </th>
        <td mat-cell *matCellDef="let row" class="text-right pr-4">
          <button mat-button (click)="openEdit(row)" class="mr-1">
            <mat-icon class="mr-1">edit</mat-icon> Editar
          </button>
          <button mat-button color="warn" (click)="delete(row)">
            <mat-icon class="mr-1">delete</mat-icon> Eliminar
          </button>
        </td>
      </ng-container>

      <tr
        mat-header-row
        *matHeaderRowDef="displayedColumns"
        class="bg-slate-50"
      ></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>
</div>
